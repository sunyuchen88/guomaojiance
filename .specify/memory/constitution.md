<!--
SYNC IMPACT REPORT
==================
Version Change: 初始版本 → 1.0.0
Modified Principles: N/A (新建宪章)
Added Sections:
  - 四个核心原则:代码质量标准、测试驱动开发、用户体验一致性、性能与可扩展性
  - 开发流程规范
  - 质量保证检查点
  - 治理规则
Removed Sections: N/A
Templates Status:
  ✅ plan-template.md - 已验证,宪章检查点对齐
  ✅ spec-template.md - 已验证,需求和成功标准对齐
  ✅ tasks-template.md - 已验证,任务分类和测试要求对齐
  ⚠️  无需更新 - agent-file-template.md, checklist-template.md (与宪章无强依赖)
Follow-up TODOs: 无
Rationale: 主版本1.0.0 - 初始宪章建立,定义了项目的核心治理原则
-->

# 国贸检测系统项目宪章

## 核心原则

### 一、代码质量标准 (NON-NEGOTIABLE)

**原则声明**:
- 所有代码必须遵循统一的编码规范和最佳实践
- 代码可读性和可维护性优先于聪明的技巧
- 强制进行代码审查,所有代码必须至少经过一人审核后方可合并
- 禁止提交包含 TODO、FIXME 或已注释代码的未完成功能到主分支

**具体要求**:
- 使用一致的命名约定:类名使用 PascalCase,函数和变量使用 camelCase
- 函数复杂度不得超过圈复杂度 10(使用静态分析工具验证)
- 每个公共 API 必须包含完整的文档注释
- 关键业务逻辑必须包含内联注释解释"为什么"而非"是什么"
- 避免魔法数字,使用命名常量
- 单个函数长度不超过 50 行,单个文件不超过 500 行(特殊情况需文档说明)

**执行理由**:
检测系统涉及数据准确性和系统可靠性的关键要求,代码质量直接影响检测结果的正确性和系统的长期维护成本。统一的高标准确保团队成员能够快速理解和修改任何模块。

---

### 二、测试驱动开发 (NON-NEGOTIABLE)

**原则声明**:
- 采用严格的测试驱动开发(TDD)流程:先写测试 → 测试失败 → 实现代码 → 测试通过 → 重构
- 所有新功能必须包含单元测试,测试覆盖率不得低于 80%
- 关键业务逻辑的测试覆盖率必须达到 100%
- 集成测试必须覆盖所有外部接口和数据交互

**测试分层要求**:
- **单元测试(必需)**:测试独立函数和类方法,使用 mock 隔离依赖
- **集成测试(必需)**:
  - 数据库交互测试
  - API 端点契约测试
  - 第三方服务集成测试
  - 检测设备通信测试
- **端到端测试(推荐)**:覆盖关键用户场景的完整流程

**测试数据要求**:
- 使用真实场景的测试数据集
- 包含边界条件和异常情况的测试用例
- 测试数据不得包含真实生产数据或敏感信息

**执行理由**:
检测系统处理关键的检测数据和报告,错误可能导致严重的业务后果。TDD 确保每个功能在开发阶段就被充分验证,减少生产环境缺陷,提高系统可靠性。

---

### 三、用户体验一致性

**原则声明**:
- 所有用户界面必须遵循统一的设计系统和交互模式
- 保持跨模块、跨平台的视觉和交互一致性
- 确保可访问性(WCAG 2.1 AA 级标准)
- 提供清晰、及时的用户反馈和错误提示

**UI/UX 标准**:
- **视觉一致性**:
  - 使用统一的颜色方案、字体系统和间距规范
  - 组件库复用率不低于 90%
  - 图标和插图风格统一
- **交互一致性**:
  - 相同操作使用相同的交互方式(例如:删除操作始终需要二次确认)
  - 加载状态、错误状态、空状态的展示方式统一
  - 表单验证规则和错误提示位置一致
- **响应式设计**:
  - 支持主流屏幕分辨率(1366x768 及以上)
  - 关键功能必须在移动端可用
- **可访问性**:
  - 所有交互元素必须支持键盘导航
  - 表单字段必须有明确的标签和错误提示
  - 色盲友好的颜色方案
  - 重要信息不能仅依赖颜色区分

**用户反馈标准**:
- 所有用户操作必须在 200ms 内提供视觉反馈
- 长时间操作(>2 秒)必须显示进度指示器
- 错误消息必须清晰说明问题和解决方案
- 成功操作提供明确的确认信息

**执行理由**:
检测系统的用户包括检测人员、管理人员和客户,一致的用户体验降低学习成本,减少操作错误,提高工作效率。可访问性确保所有用户都能有效使用系统。

---

### 四、性能与可扩展性

**原则声明**:
- 系统必须满足明确的性能基准,不得在生产环境中出现性能回退
- 所有新功能必须进行性能影响评估
- 系统架构必须支持水平扩展
- 关键操作必须包含性能监控和告警

**性能基准(不可降低)**:
- **API 响应时间**:
  - 简单查询:P95 < 200ms
  - 复杂查询:P95 < 500ms
  - 数据写入:P95 < 300ms
  - 报告生成:P95 < 2 秒
- **页面加载性能**:
  - 首屏渲染时间(FCP):< 1.5 秒
  - 最大内容绘制(LCP):< 2.5 秒
  - 首次输入延迟(FID):< 100ms
- **并发能力**:
  - 支持至少 100 并发用户
  - 数据库连接池不得耗尽
  - 无内存泄漏,长时间运行内存增长 < 10%
- **资源限制**:
  - 单次 API 请求内存占用 < 256MB
  - 单个查询返回记录数 < 1000(使用分页)
  - 文件上传大小 < 10MB(大文件使用分片上传)

**可扩展性要求**:
- 无状态服务设计,支持水平扩展
- 使用缓存策略减少数据库压力(Redis)
- 数据库查询必须使用索引,禁止全表扫描
- 大批量操作必须支持异步处理和进度追踪

**性能监控**:
- 所有 API 端点自动记录响应时间
- 慢查询日志(> 500ms)自动告警
- 定期进行压力测试和性能基准回归测试

**执行理由**:
检测系统需要处理大量检测数据和生成报告,性能问题会直接影响业务效率。明确的性能基准确保系统始终满足业务需求,可扩展性为未来增长提供保障。

---

## 开发流程规范

### 代码提交流程
1. 创建功能分支(命名规范:`feature/###-功能名称`)
2. 编写测试用例(TDD 红阶段)
3. 实现功能代码(TDD 绿阶段)
4. 重构优化(TDD 重构阶段)
5. 本地运行完整测试套件
6. 提交 Pull Request,填写完整的变更说明
7. 通过代码审查(至少一人批准)
8. 通过 CI/CD 管道所有检查
9. 合并到主分支

### 代码审查要求
- **必须检查项**:
  - 代码符合本宪章的所有原则
  - 测试覆盖率达标且测试有意义
  - 无安全漏洞(SQL 注入、XSS、CSRF 等)
  - 性能影响已评估
  - 文档和注释完整
- **禁止行为**:
  - 自我审查并合并(self-merge)
  - 未解决所有审查意见就合并
  - 绕过 CI/CD 检查强制合并

### 发布流程
1. 版本号遵循语义化版本(MAJOR.MINOR.PATCH)
2. 发布前必须通过完整的回归测试
3. 性能基准测试验证无回退
4. 更新 CHANGELOG 和发布说明
5. 生产部署前在预发布环境验证

---

## 质量保证检查点

在每个功能的生命周期中,以下检查点必须通过:

### Phase 0: 规划阶段
- [ ] 功能规格说明包含性能要求
- [ ] 识别所有需要测试的场景(正常、异常、边界)
- [ ] UI/UX 设计符合设计系统规范
- [ ] 安全风险已评估

### Phase 1: 开发阶段
- [ ] 测试先于实现编写(TDD)
- [ ] 代码符合编码规范(通过 linter 检查)
- [ ] 圈复杂度符合要求
- [ ] 文档注释完整

### Phase 2: 审查阶段
- [ ] 测试覆盖率 ≥ 80%(关键逻辑 100%)
- [ ] 代码审查通过,所有意见已解决
- [ ] 无安全扫描告警
- [ ] 性能测试通过基准要求

### Phase 3: 集成阶段
- [ ] 集成测试通过
- [ ] UI 一致性检查通过
- [ ] 可访问性测试通过
- [ ] 端到端测试通过(如适用)

### Phase 4: 发布前
- [ ] 回归测试全部通过
- [ ] 性能基准无回退
- [ ] 发布文档完整
- [ ] 回滚方案已准备

---

## 治理规则

### 宪章地位
本宪章是国贸检测系统项目的最高开发准则,所有开发活动、代码审查和技术决策必须以本宪章为依据。

### 修订流程
- 宪章修订必须经过团队讨论和一致同意
- 修订提案必须包含:
  - 修改原因和影响范围
  - 现有代码的迁移计划
  - 版本号变更说明(遵循语义化版本)
- 重大修订(MAJOR 版本):改变核心原则或移除已有规则
- 次要修订(MINOR 版本):增加新原则或扩展现有规则
- 修订补丁(PATCH 版本):澄清措辞、修正错误

### 合规性检查
- 所有 Pull Request 必须验证宪章合规性
- 技术债务必须在 issue 中明确标注并排期解决
- 违反宪章的代码不得合并,特殊情况需团队批准并文档说明

### 异常处理
在极特殊情况下(如紧急安全修复),可临时豁免部分规则,但必须:
1. 在 PR 中明确说明豁免原因
2. 获得至少两名核心成员批准
3. 创建技术债务 issue 跟踪后续修复

### 持续改进
- 每季度回顾宪章执行情况
- 收集团队反馈,识别改进机会
- 根据项目发展调整和优化规则

---

**版本**: 1.0.0 | **批准日期**: 2025-11-19 | **最后修订**: 2025-11-19
